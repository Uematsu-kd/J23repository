<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <title>役パズル</title>
</head>
<h1>役パズル</h1>

<body>
    <!--牌のボタン-->
    <!--ここからマンズ-->
    <button id="imageButton1" value="1">
        <img src="images/pai-images/man1.png">
    </button>

    <button id="imageButton2" value="2">
        <img src="images/pai-images/man2.png">
    </button>

    <button id="imageButton3" value="3">
        <img src="images/pai-images/man3.png">
    </button>

    <button id="imageButton4" value="4">
        <img src="images/pai-images/man4.png">
    </button>

    <button id="imageButton5" value="5">
        <img src="images/pai-images/man5.png">
    </button>

    <button id="imageButton6" value="6">
        <img src="images/pai-images/man6.png">
    </button>

    <button id="imageButton7" value="7">
        <img src="images/pai-images/man7.png">
    </button>

    <button id="imageButton8" value="8">
        <img src="images/pai-images/man8.png">
    </button>

    <button id="imageButton9" value="9">
        <img src="images/pai-images/man9.png">
    </button>

    <br>

    <!--ここからピンズ-->
    <button id="imageButton10" value="11">
        <img src="images/pai-images/pin1.png">
    </button>

    <button id="imageButton11" value="12">
        <img src="images/pai-images/pin2.png">
    </button>

    <button id="imageButton12" value="13">
        <img src="images/pai-images/pin3.png">
    </button>

    <button id="imageButton13" value="14">
        <img src="images/pai-images/pin4.png">
    </button>

    <button id="imageButton15" value="15">
        <img src="images/pai-images/pin5.png">
    </button>

    <button id="imageButton16" value="16">
        <img src="images/pai-images/pin6.png">
    </button>

    <button id="imageButton17" value="17">
        <img src="images/pai-images/pin7.png">
    </button>

    <button id="imageButton18" value="18">
        <img src="images/pai-images/pin8.png">
    </button>

    <button id="imageButton19" value="19">
        <img src="images/pai-images/pin9.png">
    </button>

    <br>

    <!--ここからソーズ-->
    <button id="imageButton20" value="21">
        <img src="images/pai-images/sou1.png">
    </button>

    <button id="imageButton21" value="22">
        <img src="images/pai-images/sou2.png">
    </button>

    <button id="imageButton22" value="23">
        <img src="images/pai-images/sou3.png">
    </button>

    <button id="imageButton23" value="24">
        <img src="images/pai-images/sou4.png">
    </button>

    <button id="imageButton24" value="25">
        <img src="images/pai-images/sou5.png">
    </button>

    <button id="imageButton25" value="26">
        <img src="images/pai-images/sou6.png">
    </button>

    <button id="imageButton26" value="27">
        <img src="images/pai-images/sou7.png">
    </button>

    <button id="imageButton27" value="28">
        <img src="images/pai-images/sou8.png">
    </button>

    <button id="imageButton28" value="29">
        <img src="images/pai-images/sou9.png">
    </button>

    <br>

    <!--ここから字牌-->
    <button id="imageButton29" value="31">
        <img src="images/pai-images/ji1.png">
    </button>

    <button id="imageButton30" value="32">
        <img src="images/pai-images/ji2.png">
    </button>

    <button id="imageButton31" value="33">
        <img src="images/pai-images/ji3.png">
    </button>

    <button id="imageButton32" value="34">
        <img src="images/pai-images/ji4.png">
    </button>

    <button id="imageButton33" value="35">
        <img src="images/pai-images/sangen1.png">
    </button>

    <button id="imageButton34" value="36">
        <img src="images/pai-images/sangen2.png">
    </button>

    <button id="imageButton35" value="37">
        <img src="images/pai-images/sangen3.png">
    </button>

    <br>
    <h2>手牌</h2>
    <div id="imageContainer"></div>

    <!-- 手牌をリセットするボタンを追加 -->
    <p><button id="resetButton">リセット</button></p>

    <!--   役を判定するボタンを追加     -->
    <p><button id="judgeButton">役判定</button></p>



    <script type="text/javascript">
        // 選択された牌の配列
        let selectedTiles = [];
        let hand = [];

        // 牌の数をチェックする関数
        function checkTileCount(imageSrc) {
            return selectedTiles.filter(src => src === imageSrc).length;
        }

        // 手牌エリアに牌を追加する関数
        function addTileToHand(imageSrc) {
            if (selectedTiles.length < 14 && checkTileCount(imageSrc) < 4) {
                selectedTiles.push(imageSrc);
                renderHand();
            }
        }

        // 手牌エリアを描画する関数
        function renderHand() {
            const handContainer = document.getElementById('imageContainer');
            handContainer.innerHTML = ''; // 手牌エリアをクリア
            selectedTiles.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.addEventListener('click', () => removeTileFromHand(index));
                handContainer.appendChild(img);
            });
        }
        // 手牌から牌を削除する関数
        function removeTileFromHand(index) {
            selectedTiles.splice(index, 1);
            renderHand();
            hand.splice(index, 1);
        }

        // 各牌ボタンにイベントリスナーを追加
        document.querySelectorAll('button[id^="imageButton"]').forEach(button => {
            button.addEventListener('click', () => {
                const imageSrc = button.querySelector('img').src;
                addTileToHand(imageSrc);
                const buttonValue = parseInt(button.value);
                addTileNumberToHand(buttonValue);
            });
        });
        // 手牌をリセットする関数
        document.getElementById('resetButton').addEventListener('click', () => {
            selectedTiles = []; // 選択された牌の配列をクリア
            renderHand(); // 手牌エリアを再描画
            hand = [];
        });

        // 牌を手牌に追加する関数
        function addTileNumberToHand(tileNumber) {
            if (hand.length < 14) {
                hand.push(tileNumber);
                renderHand();
            }
        }

        //役判定ボタンがクリックされた時の処理
        document.getElementById('judgeButton').addEventListener('click', () => {
            //手牌をソートする昇順に
            const hands = hand.sort((a, b) => a - b);

            if (isKokusi(hands)) {
                alert('国士無双です。')
            } else if (countTiles(hands) > 13) {
                alert('役が付きません')
            }
            if (isDaisharin(hands)) {
                alert('大三元です。')
            }
        });

        //-----------------国士無双を判定する関数-----------------------
        function isKokusi(hands) {
            // 国士無双の13種の牌
            const kokushiTiles = [1, 9, 11, 19, 21, 29, 31, 32, 33, 34, 35, 36, 37];

            // 手牌を数えるためのオブジェクト
            const tileCount = {};

            // 手牌を数える
            hand.forEach(tile => {
                tileCount[tile] = (tileCount[tile] || 0) + 1;
            });

            // 国士無双の条件を満たすかどうかを判定
            let Kokushi = true;
            kokushiTiles.forEach(tile => {
                if (!tileCount[tile]) {
                    Kokushi = false;
                }
            });

            return Kokushi;
        }

        //------------------大三元を判定する関数--------------------------
        function isDaisharin(hands) {
            // 大三元を構成する牌の種類
            const daisharinTiles = [35, 36, 37];

            // 手牌に大三元の牌が3枚以上含まれているか判定
            for (const tile of daisharinTiles) {
                const count = hands.filter(t => t === tile).length;
                if (count < 3) {
                    return false;
                }
            }

            // 手牌を数えるためのオブジェクト
            let tileCount = countTiles(hands);

            if (titleCcount > 7) {
                return false;
            }

            // 大三元が揃っている場合はtrueを返す
            return true;
        }


        //------------------一盃口を判定する関数--------------------------
        function isIipeikou(hands) {
            // 手牌を文字列に変換
            const handString = hands.join('');

            // 正規表現を使用して一盃口を検索
            const iipeikouRegex = /(11|22|33|44|55|66|77|88|99)([^0]|$)/;
            return iipeikouRegex.test(handString);
        }


        //------------------対々和を判定する関数--------------------------
        function isToitoi(hands) {
            // 手牌を数えるためのオブジェクト
            let tileCount = countTiles(hands);

            // 同じ牌が4つ以下であれば対々和と判定
            if (tileCount <= 4) {
                return true;
            }

            // 対々和でない場合はfalseを返す
            return false;
        }

        //------------------タンヤオを判定する関数--------------------------
        function isTanyao(hands) {
            // 手牌に含まれる数牌と字牌の範囲
            const invalidTiles = [1, 9, 11, 19, 21, 29, 31, 32, 33, 34, 35, 36, 37];

            // 手牌に含まれる無効な牌の数を数える
            const invalidTileCount = hands.filter(tile => invalidTiles.includes(tile)).length;

            // 手牌に1や9を含まず、字牌も含まない場合、タンヤオと判定
            if (invalidTileCount === 0) {
                return true;
            } else {
                return false;
            }
        }


        //------------------手牌の牌の種類の数を調べる関数--------------------------
        function countTiles(hands) {
            const uniqueTiles = new Set(hands);// Setオブジェクトを使用して一意の要素を取得
            return uniqueTiles.size;// Setのサイズ（要素の数）を返す
        }


    </script>
</body>

</html>